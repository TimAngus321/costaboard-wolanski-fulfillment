'use strict';Object.defineProperty(exports, "__esModule", { value: true });exports.


getEmptyOrder = getEmptyOrder;exports.













































orderIsExpressDelivery = orderIsExpressDelivery;exports.












































convertShopifyOrdersToWolanskiStructure = convertShopifyOrdersToWolanskiStructure;var _lodash = require('lodash');var _lodash2 = _interopRequireDefault(_lodash);var _slack = require('../../util/slack');function _interopRequireDefault(obj) {return obj && obj.__esModule ? obj : { default: obj };}function getEmptyOrder() {var base = { // T_KontoNr Immer die selbe Nummer (Diese erhalten Sie von Ihren Sachbearbeiter)
    T_KontoNr: process.env.WOLANSKI_ACCOUNT_NUMBER, // T_FFNR Immer die selbe Nummer (Diese erhalten Sie von Ihren Sachbearbeiter)
    T_FFNR: process.env.WOLANSKI_FULFILLMENT_NUMBER, // LFD Nummer
    T_Nummer: 0, T_Name1: '', T_Name2: '', T_Name3: '', T_Name4: '', T_Name5: '', // Länderkennzeichen wird nur eingetragen, wenn die Bestellung aus dem Ausland kommt.
    T_LKZ: '', // PLZ - Ostdeutsche mit der führenden "0" z.B. 04103 für Leipzig.
    PLZ: '', Strasse: '', T_Ort: '', // Versandinformationen an Kunden.
    Mail: '', T_Versandcode: '', // Versand: Nachnahmegebühren "x,xx"
    T_Nachnahme: '', T_ReferenzNummer: '', Auftrag: '', T_AufDat: '', KstSt: '', T_Termin: '', T_Bemerkung1: '', T_Bemerkung2: '', T_Bemerkung3: '', T_Versicher: '', Sortfeld: '', // Reserve, in diesem Feld können Sie Ihre persönliche Daten hinterlegen, dieses Feld wird zurück übermittelt.
    Reserve: '' };for (var i = 0; i < 25; i += 1) {base['T_Artikel ' + i] = '';base['T_Menge ' + i] = '';}return base;}function orderIsExpressDelivery(order) {if (!Array.isArray(order.shipping_lines)) {return false;}var shippingLineIsExpress = function shippingLineIsExpress(iShippingLine) {return iShippingLine.title === process.env.SHOPIFY_EXPRESS_DELIVERY_NAME;};var expressShippingLine = order.shipping_lines.find(shippingLineIsExpress);return !!expressShippingLine;}function generateWolanskiOrderFromShopifyOrder(sOrder, wolanskiOrderIndex) {var wOrder = getEmptyOrder();wOrder.T_Nummer = wolanskiOrderIndex;wOrder.T_Name1 = sOrder.shipping_address.name;wOrder.T_Name2 = sOrder.shipping_address.company;if (sOrder.shipping_address.country_code !== 'DE') {wOrder.T_LKZ = sOrder.shipping_address.country_code;}wOrder.PLZ = sOrder.shipping_address.zip;wOrder.Strasse = sOrder.shipping_address.address2 ? sOrder.shipping_address.address1 + ' - ' + sOrder.shipping_address.address2 : sOrder.shipping_address.address1;wOrder.T_Ort = sOrder.shipping_address.city;wOrder.Reserve = 'shopifyOrderId:' + sOrder.id;var comments = [];if (orderIsExpressDelivery(sOrder)) {console.log('generateWolanskiOrderFromShopifyOrder - express');comments.push('## Express Versand ##');} else console.log('generateWolanskiOrderFromShopifyOrder - no express');if (sOrder.note) {comments.push(sOrder.note);}wOrder.T_Bemerkung1 = comments.join('/n');_lodash2.default.forEach(sOrder.line_items, function (lineItem, lineItemIndex) {wOrder['T_Artikel ' + lineItemIndex] = lineItem.sku;wOrder['T_Menge ' + lineItemIndex] = lineItem.quantity;});return wOrder;}function convertShopifyOrdersToWolanskiStructure(shopifyOrders) {console.log('shopifyOrders: Amount ' + (shopifyOrders && shopifyOrders.length) + ' ');var ordersWithErrors = 0;var wolanski = [];shopifyOrders.forEach(function (sOrder, orderIndex) {if (!sOrder.shipping_address) {ordersWithErrors += 1;
      _slack.slack.error('shopify Order contains no sOrder.shipping_address: ``` \n' + JSON.stringify(sOrder, null, 2) + '\n ```');
      console.log('sOrder no sOrder.shipping_address: ' + JSON.stringify(sOrder, null, 2) + ' ');
    } else {
      var wolanskiOrderIndex = orderIndex + 1 - ordersWithErrors;
      wolanski.push(generateWolanskiOrderFromShopifyOrder(sOrder, wolanskiOrderIndex));
    }
  });

  return wolanski;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9vcmRlclVwbG9hZC9jc3Yvb3JkZXJVcGxvYWQuc2hvcGlmeVRvV29sYW5za2kuanMiXSwibmFtZXMiOlsiZ2V0RW1wdHlPcmRlciIsIm9yZGVySXNFeHByZXNzRGVsaXZlcnkiLCJjb252ZXJ0U2hvcGlmeU9yZGVyc1RvV29sYW5za2lTdHJ1Y3R1cmUiLCJiYXNlIiwiVF9Lb250b05yIiwicHJvY2VzcyIsImVudiIsIldPTEFOU0tJX0FDQ09VTlRfTlVNQkVSIiwiVF9GRk5SIiwiV09MQU5TS0lfRlVMRklMTE1FTlRfTlVNQkVSIiwiVF9OdW1tZXIiLCJUX05hbWUxIiwiVF9OYW1lMiIsIlRfTmFtZTMiLCJUX05hbWU0IiwiVF9OYW1lNSIsIlRfTEtaIiwiUExaIiwiU3RyYXNzZSIsIlRfT3J0IiwiTWFpbCIsIlRfVmVyc2FuZGNvZGUiLCJUX05hY2huYWhtZSIsIlRfUmVmZXJlbnpOdW1tZXIiLCJBdWZ0cmFnIiwiVF9BdWZEYXQiLCJLc3RTdCIsIlRfVGVybWluIiwiVF9CZW1lcmt1bmcxIiwiVF9CZW1lcmt1bmcyIiwiVF9CZW1lcmt1bmczIiwiVF9WZXJzaWNoZXIiLCJTb3J0ZmVsZCIsIlJlc2VydmUiLCJpIiwib3JkZXIiLCJBcnJheSIsImlzQXJyYXkiLCJzaGlwcGluZ19saW5lcyIsInNoaXBwaW5nTGluZUlzRXhwcmVzcyIsImlTaGlwcGluZ0xpbmUiLCJ0aXRsZSIsIlNIT1BJRllfRVhQUkVTU19ERUxJVkVSWV9OQU1FIiwiZXhwcmVzc1NoaXBwaW5nTGluZSIsImZpbmQiLCJnZW5lcmF0ZVdvbGFuc2tpT3JkZXJGcm9tU2hvcGlmeU9yZGVyIiwic09yZGVyIiwid29sYW5za2lPcmRlckluZGV4Iiwid09yZGVyIiwic2hpcHBpbmdfYWRkcmVzcyIsIm5hbWUiLCJjb21wYW55IiwiY291bnRyeV9jb2RlIiwiemlwIiwiYWRkcmVzczIiLCJhZGRyZXNzMSIsImNpdHkiLCJpZCIsImNvbW1lbnRzIiwiY29uc29sZSIsImxvZyIsInB1c2giLCJub3RlIiwiam9pbiIsIl8iLCJmb3JFYWNoIiwibGluZV9pdGVtcyIsImxpbmVJdGVtIiwibGluZUl0ZW1JbmRleCIsInNrdSIsInF1YW50aXR5Iiwic2hvcGlmeU9yZGVycyIsImxlbmd0aCIsIm9yZGVyc1dpdGhFcnJvcnMiLCJ3b2xhbnNraSIsIm9yZGVySW5kZXgiLCJzbGFjayIsImVycm9yIiwiSlNPTiIsInN0cmluZ2lmeSJdLCJtYXBwaW5ncyI6Ijs7O0FBR2dCQSxhLEdBQUFBLGE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE4Q0FDLHNCLEdBQUFBLHNCOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE2Q0FDLHVDLEdBQUFBLHVDLENBOUZoQixnQywrQ0FDQSx5Qyw2RkFFTyxTQUFTRixhQUFULEdBQXlCLENBQzlCLElBQU1HLE9BQU8sRUFDWDtBQUNBQyxlQUFXQyxRQUFRQyxHQUFSLENBQVlDLHVCQUZaLEVBR1g7QUFDQUMsWUFBUUgsUUFBUUMsR0FBUixDQUFZRywyQkFKVCxFQUtYO0FBQ0FDLGNBQVUsQ0FOQyxFQU9YQyxTQUFTLEVBUEUsRUFRWEMsU0FBUyxFQVJFLEVBU1hDLFNBQVMsRUFURSxFQVVYQyxTQUFTLEVBVkUsRUFXWEMsU0FBUyxFQVhFLEVBWVg7QUFDQUMsV0FBTyxFQWJJLEVBY1g7QUFDQUMsU0FBSyxFQWZNLEVBZ0JYQyxTQUFTLEVBaEJFLEVBaUJYQyxPQUFPLEVBakJJLEVBa0JYO0FBQ0FDLFVBQU0sRUFuQkssRUFvQlhDLGVBQWUsRUFwQkosRUFxQlg7QUFDQUMsaUJBQWEsRUF0QkYsRUF1QlhDLGtCQUFrQixFQXZCUCxFQXdCWEMsU0FBUyxFQXhCRSxFQXlCWEMsVUFBVSxFQXpCQyxFQTBCWEMsT0FBTyxFQTFCSSxFQTJCWEMsVUFBVSxFQTNCQyxFQTRCWEMsY0FBYyxFQTVCSCxFQTZCWEMsY0FBYyxFQTdCSCxFQThCWEMsY0FBYyxFQTlCSCxFQStCWEMsYUFBYSxF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QixDQUM1QndCLG9CQUFvQixDQUFwQjtBQUNBRyxtQkFBTUMsS0FBTiwrREFBMkVDLEtBQUtDLFNBQUwsQ0FBZWpDLE1BQWYsRUFBdUIsSUFBdkIsRUFBNkIsQ0FBN0IsQ0FBM0U7QUFDQWEsY0FBUUMsR0FBUix5Q0FBa0RrQixLQUFLQyxTQUFMLENBQWVqQyxNQUFmLEVBQXVCLElBQXZCLEVBQTZCLENBQTdCLENBQWxEO0FBQ0QsS0FKRCxNQUlPO0FBQ0wsVUFBTUMscUJBQXNCNEIsYUFBYSxDQUFkLEdBQW1CRixnQkFBOUM7QUFDQUMsZUFBU2IsSUFBVCxDQUFjaEIsc0NBQXNDQyxNQUF0QyxFQUE4Q0Msa0JBQTlDLENBQWQ7QUFDRDtBQUNGLEdBVEQ7O0FBV0EsU0FBTzJCLFFBQVA7QUFDRCIsImZpbGUiOiJvcmRlclVwbG9hZC5zaG9waWZ5VG9Xb2xhbnNraS5qcyIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBfIGZyb20gJ2xvZGFzaCc7XG5pbXBvcnQgeyBzbGFjayB9IGZyb20gJy4uLy4uL3V0aWwvc2xhY2snO1xuXG5leHBvcnQgZnVuY3Rpb24gZ2V0RW1wdHlPcmRlcigpIHtcbiAgY29uc3QgYmFzZSA9IHtcbiAgICAvLyBUX0tvbnRvTnIgSW1tZXIgZGllIHNlbGJlIE51bW1lciAoRGllc2UgZXJoYWx0ZW4gU2llIHZvbiBJaHJlbiBTYWNoYmVhcmJlaXRlcilcbiAgICBUX0tvbnRvTnI6IHByb2Nlc3MuZW52LldPTEFOU0tJX0FDQ09VTlRfTlVNQkVSLFxuICAgIC8vIFRfRkZOUiBJbW1lciBkaWUgc2VsYmUgTnVtbWVyIChEaWVzZSBlcmhhbHRlbiBTaWUgdm9uIElocmVuIFNhY2hiZWFyYmVpdGVyKVxuICAgIFRfRkZOUjogcHJvY2Vzcy5lbnYuV09MQU5TS0lfRlVMRklMTE1FTlRfTlVNQkVSLFxuICAgIC8vIExGRCBOdW1tZXJcbiAgICBUX051bW1lcjogMCxcbiAgICBUX05hbWUxOiAnJyxcbiAgICBUX05hbWUyOiAnJyxcbiAgICBUX05hbWUzOiAnJyxcbiAgICBUX05hbWU0OiAnJyxcbiAgICBUX05hbWU1OiAnJyxcbiAgICAvLyBMw6RuZGVya2VubnplaWNoZW4gd2lyZCBudXIgZWluZ2V0cmFnZW4sIHdlbm4gZGllIEJlc3RlbGx1bmcgYXVzIGRlbSBBdXNsYW5kIGtvbW10LlxuICAgIFRfTEtaOiAnJyxcbiAgICAvLyBQTFogLSBPc3RkZXV0c2NoZSBtaXQgZGVyIGbDvGhyZW5kZW4gXCIwXCIgei5CLiAwNDEwMyBmw7xyIExlaXB6aWcuXG4gICAgUExaOiAnJyxcbiAgICBTdHJhc3NlOiAnJyxcbiAgICBUX09ydDogJycsXG4gICAgLy8gVmVyc2FuZGluZm9ybWF0aW9uZW4gYW4gS3VuZGVuLlxuICAgIE1haWw6ICcnLFxuICAgIFRfVmVyc2FuZGNvZGU6ICcnLFxuICAgIC8vIFZlcnNhbmQ6IE5hY2huYWhtZWdlYsO8aHJlbiBcIngseHhcIlxuICAgIFRfTmFjaG5haG1lOiAnJyxcbiAgICBUX1JlZmVyZW56TnVtbWVyOiAnJyxcbiAgICBBdWZ0cmFnOiAnJyxcbiAgICBUX0F1ZkRhdDogJycsXG4gICAgS3N0U3Q6ICcnLFxuICAgIFRfVGVybWluOiAnJyxcbiAgICBUX0JlbWVya3VuZzE6ICcnLFxuICAgIFRfQmVtZXJrdW5nMjogJycsXG4gICAgVF9CZW1lcmt1bmczOiAnJyxcbiAgICBUX1ZlcnNpY2hlcjogJycsXG4gICAgU29ydGZlbGQ6ICcnLFxuICAgIC8vIFJlc2VydmUsIGluIGRpZXNlbSBGZWxkIGvDtm5uZW4gU2llIElocmUgcGVyc8O2bmxpY2hlIERhdGVuIGhpbnRlcmxlZ2VuLCBkaWVzZXMgRmVsZCB3aXJkIHp1csO8Y2sgw7xiZXJtaXR0ZWx0LlxuICAgIFJlc2VydmU6ICcnLFxuICB9O1xuXG4gIGZvciAobGV0IGkgPSAwOyBpIDwgMjU7IGkgKz0gMSkge1xuICAgIGJhc2VbYFRfQXJ0aWtlbCAke2l9YF0gPSAnJztcbiAgICBiYXNlW2BUX01lbmdlICR7aX1gXSA9ICcnO1xuICB9XG4gIHJldHVybiBiYXNlO1xufVxuXG5cbmV4cG9ydCBmdW5jdGlvbiBvcmRlcklzRXhwcmVzc0RlbGl2ZXJ5KG9yZGVyKSB7XG4gIGlmICghQXJyYXkuaXNBcnJheShvcmRlci5zaGlwcGluZ19saW5lcykpIHtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cbiAgXG4gIGNvbnN0IHNoaXBwaW5nTGluZUlzRXhwcmVzcyA9IGlTaGlwcGluZ0xpbmUgPT4gaVNoaXBwaW5nTGluZS50aXRsZSA9PT0gcHJvY2Vzcy5lbnYuU0hPUElGWV9FWFBSRVNTX0RFTElWRVJZX05BTUU7XG4gIGNvbnN0IGV4cHJlc3NTaGlwcGluZ0xpbmUgPSBvcmRlci5zaGlwcGluZ19saW5lcy5maW5kKHNoaXBwaW5nTGluZUlzRXhwcmVzcyk7XG4gIHJldHVybiAhIWV4cHJlc3NTaGlwcGluZ0xpbmU7XG59XG5cblxuZnVuY3Rpb24gZ2VuZXJhdGVXb2xhbnNraU9yZGVyRnJvbVNob3BpZnlPcmRlcihzT3JkZXIsIHdvbGFuc2tpT3JkZXJJbmRleCkge1xuICBcbiAgY29uc3Qgd09yZGVyID0gZ2V0RW1wdHlPcmRlcigpO1xuICB3T3JkZXIuVF9OdW1tZXIgPSB3b2xhbnNraU9yZGVySW5kZXg7XG4gIHdPcmRlci5UX05hbWUxID0gc09yZGVyLnNoaXBwaW5nX2FkZHJlc3MubmFtZTtcbiAgd09yZGVyLlRfTmFtZTIgPSBzT3JkZXIuc2hpcHBpbmdfYWRkcmVzcy5jb21wYW55O1xuICBpZiAoc09yZGVyLnNoaXBwaW5nX2FkZHJlc3MuY291bnRyeV9jb2RlICE9PSAnREUnKSB7XG4gICAgd09yZGVyLlRfTEtaID0gc09yZGVyLnNoaXBwaW5nX2FkZHJlc3MuY291bnRyeV9jb2RlO1xuICB9XG4gIHdPcmRlci5QTFogPSBzT3JkZXIuc2hpcHBpbmdfYWRkcmVzcy56aXA7XG4gIHdPcmRlci5TdHJhc3NlID0gc09yZGVyLnNoaXBwaW5nX2FkZHJlc3MuYWRkcmVzczIgP1xuICBgJHtzT3JkZXIuc2hpcHBpbmdfYWRkcmVzcy5hZGRyZXNzMX0gLSAke3NPcmRlci5zaGlwcGluZ19hZGRyZXNzLmFkZHJlc3MyfWAgOlxuICBzT3JkZXIuc2hpcHBpbmdfYWRkcmVzcy5hZGRyZXNzMTtcbiAgd09yZGVyLlRfT3J0ID0gc09yZGVyLnNoaXBwaW5nX2FkZHJlc3MuY2l0eTtcbiAgd09yZGVyLlJlc2VydmUgPSBgc2hvcGlmeU9yZGVySWQ6JHtzT3JkZXIuaWR9YDtcbiAgXG4gIGNvbnN0IGNvbW1lbnRzID0gW107XG4gIGlmIChvcmRlcklzRXhwcmVzc0RlbGl2ZXJ5KHNPcmRlcikpIHtcbiAgICBjb25zb2xlLmxvZygnZ2VuZXJhdGVXb2xhbnNraU9yZGVyRnJvbVNob3BpZnlPcmRlciAtIGV4cHJlc3MnKTtcbiAgICBjb21tZW50cy5wdXNoKCcjIyBFeHByZXNzIFZlcnNhbmQgIyMnKTtcbiAgfSBlbHNlIGNvbnNvbGUubG9nKCdnZW5lcmF0ZVdvbGFuc2tpT3JkZXJGcm9tU2hvcGlmeU9yZGVyIC0gbm8gZXhwcmVzcycpO1xuICBpZiAoc09yZGVyLm5vdGUpIHtcbiAgICBjb21tZW50cy5wdXNoKHNPcmRlci5ub3RlKTtcbiAgfVxuICB3T3JkZXIuVF9CZW1lcmt1bmcxID0gY29tbWVudHMuam9pbignL24nKTtcbiAgXG4gIF8uZm9yRWFjaChzT3JkZXIubGluZV9pdGVtcywgKGxpbmVJdGVtLCBsaW5lSXRlbUluZGV4KSA9PiB7XG4gICAgd09yZGVyW2BUX0FydGlrZWwgJHtsaW5lSXRlbUluZGV4fWBdID0gbGluZUl0ZW0uc2t1O1xuICAgIHdPcmRlcltgVF9NZW5nZSAke2xpbmVJdGVtSW5kZXh9YF0gPSBsaW5lSXRlbS5xdWFudGl0eTtcbiAgfSk7XG5cbiAgcmV0dXJuIHdPcmRlcjtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIGNvbnZlcnRTaG9waWZ5T3JkZXJzVG9Xb2xhbnNraVN0cnVjdHVyZShzaG9waWZ5T3JkZXJzKSB7XG4gIGNvbnNvbGUubG9nKGBzaG9waWZ5T3JkZXJzOiBBbW91bnQgJHtzaG9waWZ5T3JkZXJzICYmIHNob3BpZnlPcmRlcnMubGVuZ3RofSBgKTtcblxuICBsZXQgb3JkZXJzV2l0aEVycm9ycyA9IDA7XG4gIGNvbnN0IHdvbGFuc2tpID0gW107XG5cbiAgc2hvcGlmeU9yZGVycy5mb3JFYWNoKChzT3JkZXIsIG9yZGVySW5kZXgpID0+IHtcbiAgICBpZiAoIXNPcmRlci5zaGlwcGluZ19hZGRyZXNzKSB7XG4gICAgICBvcmRlcnNXaXRoRXJyb3JzICs9IDE7XG4gICAgICBzbGFjay5lcnJvcihgc2hvcGlmeSBPcmRlciBjb250YWlucyBubyBzT3JkZXIuc2hpcHBpbmdfYWRkcmVzczogXFxgXFxgXFxgIFxcbiR7SlNPTi5zdHJpbmdpZnkoc09yZGVyLCBudWxsLCAyKX1cXG4gXFxgXFxgXFxgYCk7XG4gICAgICBjb25zb2xlLmxvZyhgc09yZGVyIG5vIHNPcmRlci5zaGlwcGluZ19hZGRyZXNzOiAke0pTT04uc3RyaW5naWZ5KHNPcmRlciwgbnVsbCwgMil9IGApO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCB3b2xhbnNraU9yZGVySW5kZXggPSAob3JkZXJJbmRleCArIDEpIC0gb3JkZXJzV2l0aEVycm9ycztcbiAgICAgIHdvbGFuc2tpLnB1c2goZ2VuZXJhdGVXb2xhbnNraU9yZGVyRnJvbVNob3BpZnlPcmRlcihzT3JkZXIsIHdvbGFuc2tpT3JkZXJJbmRleCkpO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHdvbGFuc2tpO1xufVxuIl19